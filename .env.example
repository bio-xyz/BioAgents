# ============================================================================
# Authentication
# ============================================================================
# Shared secret for API authentication (JWT signing/verification and API key)
# Generate with: openssl rand -hex 32
BIOAGENTS_SECRET=change-me-to-a-secure-random-string

# Authentication mode: 'none' or 'jwt'
# - none: No auth required (development only)
# - jwt: Require JWT tokens signed with BIOAGENTS_SECRET (production)
# Note: x402 payments are controlled separately via X402_ENABLED flag
AUTH_MODE=none

# Node environment
NODE_ENV=development

# ============================================================================
# CORS Configuration (Security Critical for Production)
# ============================================================================
# Comma-separated list of allowed origins for CORS requests
# REQUIRED in production to prevent CSRF attacks
# Leave empty for development (defaults to localhost:3000, localhost:5173)
# Example: ALLOWED_ORIGINS=https://bioagent-platform.bioagents.dev,https://app.bioagents.xyz
ALLOWED_ORIGINS=

# Maximum JWT expiration time in seconds (default: 3600 = 1 hour)
# Tokens with longer expiration will be rejected
MAX_JWT_EXPIRATION=3600

OPENAI_API_KEY=
OPENSCHOLAR_API_URL=
PRIMARY_LITERATURE_AGENT=
BIO_LIT_AGENT_API_URL=
BIO_LIT_AGENT_API_KEY=
REPLY_LLM_PROVIDER=openai
REPLY_LLM_MODEL=gpt-5

HYP_LLM_PROVIDER=openai
HYP_LLM_MODEL=gpt-5

PLANNING_LLM_PROVIDER=openai
PLANNING_LLM_MODEL=gpt-5

STRUCTURED_LLM_PROVIDER=openai
STRUCTURED_LLM_MODEL=gpt-5


GOOGLE_API_KEY=
ANTHROPIC_API_KEY=
OPENROUTER_API_KEY=

PORT=3000


SUPABASE_ANON_KEY=
SUPABASE_URL=
# Service role key for backend operations (bypasses RLS)
# Get from Supabase dashboard > Settings > API > service_role key
# REQUIRED for production when RLS is enabled
SUPABASE_SERVICE_KEY=
# For migration container
SUPABASE_FULL_URL=

EMBEDDING_PROVIDER=openai
TEXT_EMBEDDING_MODEL=text-embedding-3-large
COHERE_API_KEY=

CHUNK_SIZE=2000
CHUNK_OVERLAP=200
VECTOR_SEARCH_LIMIT=20
RERANK_FINAL_LIMIT=5
USE_RERANKING=true
KNOWLEDGE_DOCS_PATH=docs
SIMILARITY_THRESHOLD=0.75
RERANKER_SCORE_THRESHOLD=0.3
# Optional: Password to protect the development UI
# Leave empty or remove this line to disable authentication
# UI_PASSWORD=your_secure_password_here

# ============================================================================
# Agent Identity Configuration (Optional)
# ============================================================================
# Name and email used for paper authorship and prompts
# If not set, papers will use "Anonymous" or just user email as author
# AGENT_NAME=BIOS
# AGENT_EMAIL=bios@bio.xyz

# ============================================================================
# Character Configuration (Optional)
# ============================================================================
# Configure the agent's persona and system prompt
# Priority: CHARACTER_JSON > CHARACTER_FILE > default BIOS character
#
# Available character files in characters/ directory:
# - characters/bios.json   - Default BIOS scientific research assistant
# - characters/aubrai.json - Aubrai (Dr Aubrey de Grey persona for longevity research)
#
# Set CHARACTER_FILE to use a character file:
CHARACTER_FILE=characters/bios.json
# CHARACTER_FILE=characters/aubrai.json
#
# Alternative: Inline JSON string (useful for simple deployments)
# CHARACTER_JSON={"name":"MyAgent","system":"You are MyAgent, a helpful assistant..."}

# ============================================================================
# SEO Configuration (Optional)
# ============================================================================
# Configure the page title, description, favicon, and OG image
# Leave empty to use defaults
SEO_TITLE=
SEO_DESCRIPTION=
FAVICON_URL=
OG_IMAGE_URL=

# ============================================================================
# Edison API (Literature + Analysis)
# ============================================================================
# Deploy from: https://github.com/bio-xyz/bio-edison-api
EDISON_API_URL=
EDISON_API_KEY=

# ============================================================================
# Data Analysis Agent Configuration
# ============================================================================
# PRIMARY_ANALYSIS_AGENT options:
# - 'edison' or empty: Use Edison Data Analysis Agent (default)
# - 'bio': Use BioAgents Data Analysis Agent
PRIMARY_ANALYSIS_AGENT=
DATA_ANALYSIS_API_URL=
DATA_ANALYSIS_API_KEY=

# ============================================================================
# Task Timeout Configuration (in minutes)
# ============================================================================
# Timeout for Bio data analysis tasks (default: 60 minutes)
BIO_ANALYSIS_TASK_TIMEOUT_MINUTES=60
# Timeout for Bio literature search tasks (default: 60 minutes)
BIO_LITERATURE_TASK_TIMEOUT_MINUTES=60
# Timeout for Edison tasks (default: 30 minutes)
EDISON_TASK_TIMEOUT_MINUTES=30
# TTL for file status records (default: 60 minutes)
FILE_STATUS_TTL_MINUTES=60

# ============================================================================
# JWT Authentication (for external frontends)
# ============================================================================
# When AUTH_MODE=jwt, external frontends sign JWTs with BIOAGENTS_SECRET
# JWT payload must include 'sub' claim with a valid UUID (user ID)
# See docs/JWT_AUTH_GUIDE.md for integration details

# ===========================================================================
# Storage Configuration (Optional)
# ===========================================================================
# Available options: 's3' (it empty or not set, storage is disabled)
STORAGE_PROVIDER=

# Use either the AWS_* or S3_* variants (not both strictly required).
# Primary, required (AWS-style) variables:
AWS_ACCESS_KEY_ID=your_aws_access_key_id_here
AWS_SECRET_ACCESS_KEY=your_aws_secret_access_key_here
AWS_REGION=us-east-1

# Optional alternative (S3-specific) variables:
# S3_ACCESS_KEY_ID=your_s3_access_key_id_here
# S3_SECRET_ACCESS_KEY=your_s3_secret_access_key_here
# S3_REGION=us-east-1

# Required: target bucket
S3_BUCKET=your-bucket-name-here

# Optional: custom S3 endpoint (for MinIO, DO Spaces, etc.)
# Example: https://nyc3.digitaloceanspaces.com
S3_ENDPOINT=


# ============================================================================
# Payment Protocols (x402, b402, CDP)
# ============================================================================
# Micropayment protocols for pay-per-request API access
# - x402: USDC payments on Base network
# - b402: USDT payments on BNB Chain

# Coinbase Developer Platform credentials (required for x402 mainnet)
# Get from: https://portal.cdp.coinbase.com/access/api
CDP_API_KEY_ID=
CDP_API_KEY_SECRET=
CDP_PROJECT_ID=

# --- x402 (Base/USDC) ---
X402_ENABLED=false
X402_ENVIRONMENT=testnet                # testnet (Base Sepolia) or mainnet (Base)
X402_PAYMENT_ADDRESS=                   # Your wallet address (0x...)
X402_FACILITATOR_URL=https://x402.org/facilitator
X402_NETWORK=base-sepolia               # auto: base-sepolia or base
X402_ASSET=USDC
X402_USDC_ADDRESS=0x036CbD53842c5426634e7929541eC2318f3dCF7e  # Testnet address
X402_TIMEOUT=30

# --- b402 (BNB Chain/USDT) ---
B402_ENABLED=false
B402_ENVIRONMENT=testnet                # testnet (BNB Testnet) or mainnet (BNB)
B402_PAYMENT_ADDRESS=                   # Your wallet address (0x...)
B402_FACILITATOR_URL=https://facilitator.bioagents.dev
B402_NETWORK=bnb-testnet                # auto: bnb-testnet or bnb
B402_ASSET=USDT
B402_USDT_ADDRESS=0x337610d27c682E347C9cD60BD4b3b107C9d34dDd  # Testnet address
B402_TIMEOUT=30

# ============================================================================
# BullMQ Job Queue Configuration
# ============================================================================
# Enable/disable job queue (false = in-process execution, true = BullMQ queue)
# Set to false for local development without Redis
USE_JOB_QUEUE=false
# Admin Dashboard (Bull Board)
ADMIN_USERNAME=admin       # Dashboard username (default: 'admin')
ADMIN_PASSWORD=            # Dashboard password (REQUIRED in production)


# Redis connection for BullMQ job queue
# Required when USE_JOB_QUEUE=true
REDIS_URL=redis://localhost:6379

# Alternative Redis configuration (used if REDIS_URL not set)
# REDIS_HOST=localhost
# REDIS_PORT=6379
# REDIS_PASSWORD=

# Queue concurrency settings
CHAT_QUEUE_CONCURRENCY=5
DEEP_RESEARCH_QUEUE_CONCURRENCY=3
PAPER_GENERATION_CONCURRENCY=1

# Paper generation limits
# Max concurrent paper jobs across all users (default: 3)
MAX_CONCURRENT_PAPER_JOBS=3

# Rate limiting (per user)
CHAT_RATE_LIMIT_PER_MINUTE=10
DEEP_RESEARCH_RATE_LIMIT_PER_5MIN=3

# ============================================================================
# Autonomous Research Loop Configuration
# ============================================================================
# Controls how the deep research loop decides to continue autonomously vs ask user

# LLM provider for the continue research decision agent
CONTINUE_RESEARCH_LLM_PROVIDER=anthropic
CONTINUE_RESEARCH_LLM_MODEL=claude-sonnet-4-5-20250929

# Maximum autonomous iterations before asking user (when fullyAutonomous=false)
# When fullyAutonomous=true, the hard cap is 20 iterations regardless of this setting
MAX_AUTO_ITERATIONS=5
